#include "cpu.h"

#include <stdio.h>
#include <stdlib.h>

/************************************************
 *  PUBLIC FUNCTIONS
 ***********************************************/

void createCpu(mos6502 *_cpu) {
    _cpu->A = 0;
    _cpu->PC = 0x8000;
    _cpu->SP = 0xFF;
    _cpu->flags = 0;
    _cpu->X = 0;
    _cpu->Y = 0;
    _cpu->interrupts = 0;
    _cpu->devices = nullptr;
    _cpu->deviceCount = 0;
    fputs("CREATED CPU\n", stdout);
}

makeDeviceAdder(mos6502);
makeDeviceReader(mos6502);
makeDeviceWriter(mos6502);

void push(mos6502 *_cpu, uint8_t value) {
    write_mos6502(_cpu, 0x100 + (_cpu->SP--), value);
}

uint8_t pop(mos6502 *_cpu) {
    return read_mos6502(_cpu, 0x100 + (++_cpu->SP));
}


/************************************************
 *  FLAG FUNCTIONS
 ***********************************************/

#define FLAG_N 0b10000000
#define FLAG_V 0b01000000
#define FLAG_B 0b00010000
#define FLAG_D 0b00001000
#define FLAG_I 0b00000100
#define FLAG_Z 0b00000010
#define FLAG_C 0b00000001

inline void setFlags(mos6502 *_cpu, uint8_t flags) {
    _cpu->flags |= flags;
}

inline void setFlag(mos6502 *_cpu, uint8_t flag, bool state) {
    if (state) _cpu->flags |= flag;
    else _cpu->flags &= ~flag;
}

inline void unsetFlag(mos6502 *_cpu, uint8_t flag) {
    _cpu->flags &= ~flag;
}

inline bool testFlag(mos6502 *_cpu, uint8_t flag) {
    return _cpu->flags & flag;
}

inline void donz(mos6502 *_cpu, uint8_t val) {
    setFlag(_cpu, FLAG_N, val & 0x80);
    setFlag(_cpu, FLAG_Z, !val);
}

inline void donzc(mos6502 *_cpu, uint16_t val) {
    setFlag(_cpu, FLAG_N, val & 0x80);
    setFlag(_cpu, FLAG_Z, !(val & 0xff));
    setFlag(_cpu, FLAG_C, val & 0x100);
}

/************************************************
 *  INTERRUPT FUNCTIONS
 ***********************************************/

#define IRQ_VEC 0xFFFE
#define NMI_VEC 0xFFFA
#define BRK_VEC 0xFFFE
#define RST_VEC 0xFFFC

void triggerNMI(mos6502 *_cpu) {
    _cpu->PC += 2;
    push(_cpu, _cpu->PC >> 8);
    push(_cpu, _cpu->PC & 0xff);
    push(_cpu, _cpu->flags);
    setFlags(_cpu, FLAG_I);
    _cpu->PC = read_mos6502(_cpu, NMI_VEC);
    _cpu->PC |= read_mos6502(_cpu, NMI_VEC + 1) << 8;
}

void triggerRST(mos6502 *_cpu) {
    _cpu->PC += 2;
    push(_cpu, _cpu->PC >> 8);
    push(_cpu, _cpu->PC & 0xff);
    push(_cpu, _cpu->flags);
    setFlags(_cpu, FLAG_I);
    _cpu->PC = read_mos6502(_cpu, RST_VEC);
    _cpu->PC |= read_mos6502(_cpu, RST_VEC + 1) << 8;

}

void triggerIRQ(mos6502 *_cpu) {
    _cpu->PC += 2;
    push(_cpu, _cpu->PC >> 8);
    push(_cpu, _cpu->PC & 0xff);
    push(_cpu, _cpu->flags);
    setFlags(_cpu, FLAG_I);
    _cpu->PC = read_mos6502(_cpu, IRQ_VEC);
    _cpu->PC |= read_mos6502(_cpu, IRQ_VEC + 1) << 8;
}

/************************************************
 *  ADDRESS MODES
 ***********************************************/

uint16_t abss(mos6502 *_cpu) {
    uint16_t address = read_mos6502(_cpu, _cpu->PC) | (read_mos6502(_cpu, _cpu->PC + 1) << 8);
    _cpu->PC += 2;
    return address;

}

uint8_t accRead(mos6502 *_cpu) {
    return _cpu->A;
}

void accWrite(mos6502 *_cpu, uint8_t val) {
    _cpu->A = val;
}

uint16_t absx(mos6502 *_cpu) {
    uint16_t ret = (read_mos6502(_cpu, _cpu->PC) | (read_mos6502(_cpu, _cpu->PC + 1) << 8)) + _cpu->X;
    _cpu->PC += 2;
    return ret;
}

uint16_t absy(mos6502 *_cpu) {
    uint16_t ret = (read_mos6502(_cpu, _cpu->PC) | (read_mos6502(_cpu, _cpu->PC + 1) << 8)) + _cpu->Y;
    _cpu->PC += 2;
    return ret;
}

uint16_t imm(mos6502 *_cpu) {
    return _cpu->PC++;
}

uint16_t ind(mos6502 *_cpu) {
    uint16_t address = (read_mos6502(_cpu, _cpu->PC) | (read_mos6502(_cpu, _cpu->PC + 1) << 8));
    uint16_t v = read_mos6502(_cpu, address) | (read_mos6502(_cpu, address + 1) << 8);
    _cpu->PC += 2;
    return v;
}

uint16_t xind(mos6502 *_cpu) {
    uint16_t address = (read_mos6502(_cpu, _cpu->PC) | (read_mos6502(_cpu, _cpu->PC + 1) << 8)) + _cpu->X;
    uint16_t v = read_mos6502(_cpu, address) | (read_mos6502(_cpu, address + 1) << 8);
    _cpu->PC += 2;
    return v;
}

uint16_t indy(mos6502 *_cpu) {
    uint16_t address = (read_mos6502(_cpu, _cpu->PC) | (read_mos6502(_cpu, _cpu->PC + 1) << 8));
    uint16_t v = (uint8_t) (read_mos6502(_cpu, address) | (read_mos6502(_cpu, address + 1) << 8) + _cpu->Y);
    _cpu->PC += 2;
    return v;
}

uint16_t inline zpg(mos6502 *_cpu) {
    uint16_t val = read_mos6502(_cpu, _cpu->PC);
    _cpu->PC += 1;
    return val;
}

uint16_t inline zpgx(mos6502 *_cpu) {
    uint16_t val = (uint8_t) (read_mos6502(_cpu, _cpu->PC) + _cpu->X);
    _cpu->PC += 1;
    return val;
}

uint16_t inline zpgy(mos6502 *_cpu) {
    uint16_t val = (uint8_t) (read_mos6502(_cpu, _cpu->PC) + _cpu->Y);
    _cpu->PC += 1;
    return val;
}

uint16_t inline rel(mos6502 *_cpu) {
    return (int8_t) read_mos6502(_cpu, _cpu->PC++) + _cpu->PC;
}

/************************************************
 *  INSTRUCTIONS
 ***********************************************/

int NOP(mos6502 *_cpu) {
    //fprintf(stdout, "NOP at %X\n", _cpu->PC);
    return 2;
}

int BRK(mos6502 *_cpu) {
    _cpu->PC += 2;
    push(_cpu, _cpu->PC >> 8);
    push(_cpu, _cpu->PC & 0xff);
    setFlags(_cpu, FLAG_B);
    push(_cpu, _cpu->flags);
    setFlags(_cpu, FLAG_I);
    _cpu->PC = read_mos6502(_cpu, IRQ_VEC);
    _cpu->PC |= read_mos6502(_cpu, IRQ_VEC + 1) << 8;
    return 7;
//exit(1);
}//7 cycles ----------------IMPLEMENT THIS WHEN I KNOW WHAT IT DOES---------------------------

#define makeCL(flag) int CL##flag(mos6502 *_cpu) {\
    unsetFlag(_cpu, FLAG_##flag);\
    return 2;\
}
makeCL(C)
makeCL(I)
makeCL(V)
makeCL(D)

#define makeSE(flag) int SE##flag(mos6502 *_cpu) {\
    setFlags(_cpu, FLAG_##flag);\
    return 2;\
}
makeSE(C)
makeSE(I)
makeSE(D)

#define makeORA(addMode, clockcycles) int ORA_##addMode (mos6502 *_cpu) {\
    uint8_t v = _cpu->A | read_mos6502(_cpu, addMode(_cpu));\
    _cpu->A = v;\
    donz(_cpu, v);\
    return clockcycles;\
}
makeORA(imm, 2)
makeORA(zpg, 3)
makeORA(zpgx, 4)
makeORA(abss, 4)
makeORA(xind, 6)
makeORA(indy, 5)
makeORA(absx, 4)
makeORA(absy, 4)

#define makeASL(addMode, clockcycles) int ASL_##addMode (mos6502 *_cpu) {\
    uint16_t address = addMode(_cpu);\
    uint16_t v = read_mos6502(_cpu, address) << 1;\
    write_mos6502(_cpu, address, (uint8_t) v);\
    donzc(_cpu, v);\
    return clockcycles;\
}
makeASL(zpg, 5)
makeASL(zpgx, 6)
makeASL(abss, 6)
makeASL(absx, 7)

int ASLA(mos6502 *_cpu) {
    uint16_t v = _cpu->A << 1;
    _cpu->A = (uint8_t) v;
    donzc(_cpu, v);
    return 2;
}

#define makeJSR(addMode, clockcycles) int JSR(mos6502 *_cpu) {\
    uint16_t v = addMode(_cpu);\
    _cpu->PC-=1;\
    push(_cpu, _cpu->PC & 0x00ff);\
    push(_cpu, _cpu->PC >> 8);\
    _cpu->PC = v;\
    return clockcycles;\
}// 6 cycles
makeJSR(abss, 6)

#define makeBIT(addMode, clockcycles) int BIT_##addMode (mos6502 *_cpu) {\
    uint8_t res = _cpu->A & read_mos6502(_cpu, addMode(_cpu));\
    donz(_cpu, res);\
    setFlag(_cpu, FLAG_V, res & 0x40);\
    return clockcycles;\
}
makeBIT(zpg, 3)
makeBIT(abss, 4)

#define makeAND(addMode, clockcycles) int AND_##addMode (mos6502 *_cpu) {\
    uint8_t v = _cpu->A & read_mos6502(_cpu, addMode(_cpu));\
    _cpu->A = v;\
    donz(_cpu, v);\
    return clockcycles;\
}
makeAND(imm, 2);
makeAND(zpg, 3);
makeAND(zpgx, 4);
makeAND(abss, 4);
makeAND(absx, 4);
makeAND(absy, 4);
makeAND(xind, 6);
makeAND(indy, 5);

#define makeROL(addMode, clockcycles) int ROL_##addMode (mos6502 *_cpu) {\
    uint16_t address = addMode(_cpu);\
    uint8_t v = read_mos6502(_cpu, address);\
    v = (v << 1) | (v >> 7);\
    write_mos6502(_cpu, address, v);\
    donz(_cpu, v);\
    setFlag(_cpu, FLAG_C, v & 1);\
    return clockcycles;\
}
makeROL(zpg, 5)
makeROL(zpgx, 6)
makeROL(abss, 6)
makeROL(absx, 7)

int ROLA(mos6502 *_cpu) {
    uint8_t v = _cpu->A;
    v = (v << 1) | (v >> 7);
    _cpu->A = v;
    donz(_cpu, v);
    setFlag(_cpu, FLAG_C, v & 1);
    return 2;
}

#define makeJMP(addMode, clockcycles) int JMP_##addMode (mos6502 *_cpu) {\
    _cpu->PC = addMode(_cpu);\
    return clockcycles;\
}
makeJMP(abss, 3)
makeJMP(ind, 5)

#define makeLSR(addMode, clockcycles) int LSR_##addMode (mos6502 *_cpu) {\
    uint16_t address = addMode(_cpu);\
    uint8_t rval = read_mos6502(_cpu, address);\
    uint8_t wval = rval >> 1;\
    write_mos6502(_cpu, address, wval);\
    donz(_cpu, wval);\
    setFlag(_cpu, FLAG_C, rval & 1);\
    return clockcycles;\
}
makeLSR(zpg, 3)
makeLSR(zpgx, 4)
makeLSR(abss, 4)
makeLSR(absx, 5)

int LSRA(mos6502 *_cpu) {
    uint8_t rval = _cpu->A;
    uint8_t wval = rval >> 1;
    _cpu->A = wval;
    donz(_cpu, wval);
    setFlag(_cpu, FLAG_C, rval & 1);
    return 2;
}

#define makeEOR(addMode, clockcycles) int EOR_##addMode (mos6502 *_cpu) {\
    _cpu->A ^= read_mos6502(_cpu, addMode(_cpu));\
    donz(_cpu, _cpu->A);\
    return clockcycles;\
}
makeEOR(imm, 2)
makeEOR(zpg, 3)
makeEOR(zpgx, 4)
makeEOR(abss, 4)
makeEOR(absx, 4)
makeEOR(absy, 4)
makeEOR(xind, 6)
makeEOR(indy, 5)

#define makeADC(addMode, clockcycles) int ADC_##addMode (mos6502 *_cpu) {\
    uint8_t v = read_mos6502(_cpu, addMode(_cpu));\
    uint8_t mayover = ~(v ^ _cpu->A);\
    uint16_t total = v + _cpu->A + (testFlag(_cpu, FLAG_C) ? 1 : 0);\
    _cpu->A = (uint8_t) total;\
    donzc(_cpu, total);\
    setFlag(_cpu, FLAG_V, mayover & (v ^ _cpu->A) & 0x80);\
    return clockcycles;\
}
makeADC(imm, 2)
makeADC(zpg, 3)
makeADC(zpgx, 4)
makeADC(abss, 4)
makeADC(absx, 4)
makeADC(absy, 4)
makeADC(xind, 6)
makeADC(indy, 5)

#define makeSBC(addMode, clockcycles) int SBC_##addMode(mos6502 *_cpu) {\
    uint8_t v = ~read_mos6502(_cpu, addMode(_cpu));\
    uint16_t val = _cpu->A - v - (testFlag(_cpu, FLAG_C) ? 1 : 0);\
    _cpu->A = (uint8_t) val;\
    donzc(_cpu, val);\
    setFlag(_cpu, FLAG_V, (v ^ _cpu->A) & 0x80);\
    return clockcycles;\
}
makeSBC(imm, 2)
makeSBC(zpg, 3)
makeSBC(zpgx, 4)
makeSBC(abss, 4)
makeSBC(absx, 4)
makeSBC(absy, 4)
makeSBC(xind, 6)
makeSBC(indy, 5)

#define makeCMP(addMode, clockcycles) int CMP_##addMode (mos6502 *_cpu) {\
    uint16_t v = _cpu->A - read_mos6502(_cpu, addMode(_cpu));\
    donzc(_cpu, v);\
    return clockcycles;\
}

#define makeCP_(reg, addMode, clockcycles) int CP##reg##_##addMode (mos6502 *_cpu) {\
    uint16_t v = _cpu->reg - read_mos6502(_cpu, addMode(_cpu));\
    donzc(_cpu, v);\
    return clockcycles;\
}
makeCMP(imm, 2)
makeCMP(zpg, 3)
makeCMP(zpgx, 4)
makeCMP(abss, 4)
makeCMP(absx, 4)
makeCMP(absy, 4)
makeCMP(xind, 6)
makeCMP(indy, 5)

makeCP_(X, imm, 2)
makeCP_(X, zpg, 3)
makeCP_(X, abss, 4)

makeCP_(Y, imm, 2)
makeCP_(Y, zpg, 3)
makeCP_(Y, abss, 4)

#define makeROR(addMode, clockcycles) int ROR_##addMode (mos6502 *_cpu) {\
    uint16_t address = addMode(_cpu);\
    uint8_t v = read_mos6502(_cpu, address);\
    v = (v >> 1) | (v << 7);\
    write_mos6502(_cpu, address, v);\
    donz(_cpu, v);\
    setFlag(_cpu, FLAG_C, v & 0x80);\
    return clockcycles;\
}
makeROR(zpg, 5)
makeROR(zpgx, 6)
makeROR(abss, 6)
makeROR(absx, 7)

int RORA(mos6502 *_cpu) {
    uint8_t v = _cpu->A;
    v = (v >> 1) | (v << 7);
    _cpu->A = v;
    donz(_cpu, v);
    setFlag(_cpu, FLAG_C, v & 0x80);
    return 2;
}

#define makeST(reg, addMode, clockcycles) int ST##reg##_##addMode (mos6502 *_cpu) {\
    write_mos6502(_cpu, addMode(_cpu), _cpu->reg);\
    return clockcycles;\
}
makeST(A, zpg, 3)
makeST(A, zpgx, 4)
makeST(A, abss, 4)
makeST(A, absx, 5)
makeST(A, absy, 5)
makeST(A, xind, 6)
makeST(A, indy, 6)

makeST(X, zpg, 3)
makeST(X, zpgy, 4)
makeST(X, abss, 4)

makeST(Y, zpg, 3)
makeST(Y, zpgx, 4)
makeST(Y, abss, 4)

#define makeT(r1, r2) int T##r1##r2(mos6502 *_cpu) {\
    _cpu->r2 = _cpu->r1;\
    donz(_cpu, _cpu->r1);\
    return 2;\
}
makeT(A,X)
makeT(A,Y)
makeT(SP,X)
makeT(X, A)
makeT(Y, A)

int TXS(mos6502 *_cpu) {
    _cpu->SP = _cpu->X;
    return 2;
}

#define makeLD(reg, addMode, clockcycles) int LD##reg##_##addMode(mos6502 *_cpu) {\
    _cpu->reg = read_mos6502(_cpu, addMode(_cpu));\
    donz(_cpu, _cpu->reg);\
    return clockcycles;\
}
makeLD(A, imm, 2)
makeLD(A, zpg, 3)
makeLD(A, zpgx, 4)
makeLD(A, abss, 4)
makeLD(A, absx, 4)
makeLD(A, absy, 4)
makeLD(A, xind, 6)
makeLD(A, indy, 5)

makeLD(X, imm, 2)
makeLD(X, zpg, 3)
makeLD(X, zpgy, 4)
makeLD(X, abss, 4)
makeLD(X, absy, 4)

makeLD(Y, imm, 2)
makeLD(Y, zpg, 3)
makeLD(Y, zpgx, 4)
makeLD(Y, abss, 4)
makeLD(Y, absx, 4)

#define makeB_C(flag, clockcycles) int B##flag##C (mos6502 *_cpu) {\
    uint16_t add = rel(_cpu);\
    if (!testFlag(_cpu, FLAG_##flag)) { _cpu->PC = add; }\
    return clockcycles;\
}

#define makeB_S(flag, clockcycles) int B##flag##S (mos6502 *_cpu) {\
    uint16_t add = rel(_cpu);\
    if (testFlag(_cpu, FLAG_##flag)) { _cpu->PC = add; }\
    return clockcycles;\
}
makeB_C(C, 2)
makeB_S(C, 2)
makeB_C(Z, 2)//BNE
makeB_S(Z, 2)//BEQ
makeB_C(V, 2)
makeB_S(V, 2)
makeB_C(N, 2)//BPL
makeB_S(N, 2)//BMI

#define makeINC(addMode, clockcycles) int INC_##addMode(mos6502 *_cpu) {\
    uint16_t address = addMode(_cpu);\
    write_mos6502(_cpu, address, read_mos6502(_cpu, address) + 1);\
    return clockcycles;\
}

#define makeIN_(reg) int IN##reg (mos6502 *_cpu) {\
    ++_cpu->reg;\
    donz(_cpu, _cpu->reg);\
    return 2;\
}

#define makeDEC(addMode, clockcycles) int DEC_##addMode (mos6502 *_cpu) {\
    uint16_t address = addMode(_cpu);\
    uint8_t val = read_mos6502(_cpu, address) - 1;\
    write_mos6502(_cpu, address, val);\
    donz(_cpu, val);\
    return clockcycles;\
}

#define makeDE_(reg) int DE##reg (mos6502 *_cpu) {\
    --_cpu->reg;\
    donz(_cpu, _cpu->reg);\
    return 2;\
}
makeINC(zpg, 5)
makeDEC(zpg, 5)
makeINC(zpgx, 6)
makeDEC(zpgx, 6)
makeINC(abss, 6)
makeDEC(abss, 6)
makeINC(absx, 7)
makeDEC(absx, 7)
makeIN_(X)
makeDE_(X)
makeIN_(Y)
makeDE_(Y)

int PLA(mos6502 *_cpu) {
    _cpu->A = pop(_cpu);
    donz(_cpu, _cpu->A);
    return 4;
}

int PHA(mos6502 *_cpu) {
    push(_cpu, _cpu->A);
    return 3;
}

int PLP(mos6502 *_cpu) {
    _cpu->flags = pop(_cpu);
    return 4;
}

int PHP(mos6502 *_cpu) {
    push(_cpu, _cpu->flags);
    return 3;
}

int RTI(mos6502 *_cpu) {
    _cpu->flags = pop(_cpu);
    _cpu->PC = (pop(_cpu) << 8) | pop(_cpu);
    return 6;
}

int RTS(mos6502 *_cpu) {
    _cpu->PC = (pop(_cpu) << 8) + pop(_cpu)+1;
    return 6;
}

int ERR(mos6502 *_cpu){
    getc(stdin);
    return 10000000;
}

static const mos6502instruction cpuopmap[256] = {
    //00   , 01      , 02     , 03 , 04      , 05      , 06      , 07 , 08 , 09      , 0A  , 0B , 0C      , 0D      , 0E      , 0F
    BRK    , ORA_xind, ERR    , ERR, ERR     , ORA_zpg , ASL_zpg , ERR, PHP, ORA_imm , ASLA, ERR, ERR     , ORA_abss, ASL_abss, ERR,//00
    BNC    , ORA_indy, ERR    , ERR, ERR     , ORA_zpgx, ASL_zpgx, ERR, CLC, ORA_absy, ERR , ERR, ERR     , ORA_absx, ASL_absx, ERR,//10
    JSR    , AND_xind, ERR    , ERR, BIT_zpg , AND_zpg , ROL_zpg , ERR, PLP, AND_imm , ROLA, ERR, BIT_abss, AND_abss, ROL_abss, ERR,//20
    BNS    , AND_indy, ERR    , ERR, ERR     , AND_zpgx, ROL_zpgx, ERR, SEC, AND_absy, ERR , ERR, ERR     , AND_absx, ROL_absx, ERR,//30
    RTI    , EOR_xind, ERR    , ERR, ERR     , EOR_zpg , LSR_zpg , ERR, PHA, EOR_imm , LSRA, ERR, JMP_abss, EOR_abss, LSR_abss, ERR,//40
    BVC    , EOR_indy, ERR    , ERR, ERR     , EOR_zpgx, LSR_zpgx, ERR, CLI, EOR_absy, ERR , ERR, ERR     , EOR_absx, LSR_absx, ERR,//50
    RTS    , ADC_xind, ERR    , ERR, ERR     , ADC_zpg , ROR_zpg , ERR, PLA, ADC_imm , RORA, ERR, JMP_ind , ADC_abss, ROR_abss, ERR,//60
    BVS    , ADC_indy, ERR    , ERR, ERR     , ADC_zpgx, ROR_zpgx, ERR, SEI, ADC_absy, ERR , ERR, ERR     , ADC_absx, ROR_absx, ERR,//70
    ERR    , STA_xind, ERR    , ERR, STY_zpg , STA_zpg , STX_zpg , ERR, DEY, ERR     , TXA , ERR, STY_abss, STA_abss, STX_abss, ERR,//80
    BCC    , STA_indy, ERR    , ERR, STY_zpgx, STA_zpgx, STX_zpgy, ERR, TYA, STA_absy, TXS , ERR, ERR     , STA_absx, ERR     , ERR,//90
    LDY_imm, LDA_xind, LDX_imm, ERR, LDY_zpg , LDA_zpg , LDX_zpg , ERR, TAY, LDA_imm , TAX , ERR, LDY_abss, LDA_abss, LDX_abss, ERR,//A0
    BCS    , LDA_indy, ERR    , ERR, LDY_zpgx, LDA_zpgx, LDX_zpgy, ERR, CLV, LDA_absy, TSPX, ERR, LDY_absx, LDA_absx, LDX_absy, ERR,//B0
    CPY_imm, CMP_xind, ERR    , ERR, CPY_zpg , CMP_zpg , DEC_zpg , ERR, INY, CMP_imm , DEX , ERR, CPY_abss, CMP_abss, DEC_abss, ERR,//C0
    BZC    , CMP_indy, ERR    , ERR, ERR     , CMP_zpgx, DEC_zpgx, ERR, CLD, CMP_absy, ERR , ERR, ERR     , CMP_absx, DEC_absx, ERR,//D0
    CPX_imm, SBC_xind, ERR    , ERR, CPX_zpg , SBC_zpg , INC_zpg , ERR, INX, SBC_imm , NOP , ERR, CPX_abss, SBC_abss, INC_abss, ERR,//E0
    BZS    , SBC_indy, ERR    , ERR, ERR     , SBC_zpgx, INC_zpgx, ERR, SED, SBC_absy, ERR , ERR, ERR     , SBC_absx, INC_absx, ERR,//F0
};

uint8_t chonker[] = {76,162,134,134,134,32,234,56,176,234,24,176,76,234,56,144,76,234,24,144,234,169,240,234,169,240,76,234,169,208,234,169,208,76,234,169,133,36,112,234,36,80,76,234,169,133,36,80,234,36,112,76,234,169,16,234,169,16,76,234,96,32,234,169,133,36,169,56,120,248,8,104,41,201,240,234,169,133,36,216,169,24,8,104,41,201,240,234,169,133,36,248,169,56,8,104,41,201,240,234,169,72,40,208,16,80,144,76,234,169,72,40,240,48,112,176,76,234,248,169,133,36,24,169,72,169,104,208,48,80,176,76,234,169,133,36,56,169,72,169,104,240,16,112,144,76,96,32,234,24,169,133,36,169,9,176,16,201,208,80,76,234,56,184,169,9,208,112,144,48,76,234,24,36,169,41,208,80,176,48,76,234,56,184,169,41,144,16,201,208,112,76,234,24,36,169,73,176,16,201,208,80,76,234,56,184,169,73,208,112,144,48,76,234,24,36,169,105,48,176,201,208,112,76,234,56,248,36,169,105,48,176,201,208,112,76,234,216,56,184,169,105,16,176,201,208,80,76,234,24,36,169,105,16,176,201,208,112,76,234,56,184,169,105,208,48,112,144,76,234,56,184,169,240,16,112,144,76,234,24,36,169,208,48,80,176,76,234,36,169,201,48,144,208,80,76,234,184,201,240,48,144,112,76,234,201,240,16,16,76,234,169,201,240,16,144,76,234,201,208,48,144,76,234,201,176,240,16,76,234,201,144,240,48,76,234,36,160,192,208,48,144,80,76,234,184,192,240,48,144,112,76,234,192,240,16,16,76,234,160,192,240,16,144,76,234,192,208,48,144,76,234,192,176,240,16,76,234,192,144,240,48,76,234,36,162,224,208,48,144,80,76,234,184,224,240,48,144,112,76,234,224,240,16,16,76,234,162,224,240,16,144,76,234,224,208,48,144,76,234,224,176,240,16,76,234,224,144,240,48,76,234,56,184,162,240,16,112,144,76,234,24,36,162,208,48,80,176,76,234,56,184,160,240,16,112,144,76,234,24,36,160,208,48,80,176,76,234,169,162,160,201,208,224,208,192,208,201,208,224,208,192,208,201,240,224,240,192,240,76,160,32,36,169,56,96,233,32,48,144,208,112,201,208,96,200,32,184,56,169,96,233,32,240,48,144,112,201,208,96,200,32,169,56,36,96,233,32,176,240,16,112,201,208,96,200,32,24,169,96,233,32,144,201,208,96,200,32,56,169,96,233,32,80,144,201,208,96,96,32,234,169,133,169,162,160,232,136,224,208,192,208,232,232,136,136,224,208,192,208,202,200,224,208,192,208,201,208,76,234,56,162,169,36,160,200,208,48,144,80,192,208,200,240,48,144,80,24,184,160,136,240,16,176,112,192,208,24,136,240,16,176,112,192,208,201,208,224,208,76,234,56,160,169,36,162,232,208,48,144,80,224,208,232,240,48,144,80,24,184,162,202,240,16,176,112,224,208,24,202,240,16,176,112,224,208,201,208,192,208,76,234,169,162,160,24,36,168,240,176,80,16,201,208,224,208,192,208,169,56,184,168,208,144,112,48,201,208,224,208,192,208,76,234,169,162,160,24,36,170,240,176,80,16,201,208,224,208,192,208,169,56,184,170,208,144,112,48,201,208,224,208,192,208,76,234,169,162,160,24,36,152,240,176,80,16,201,208,224,208,192,208,160,56,184,152,208,144,112,48,201,208,224,208,192,208,76,234,169,162,160,24,36,138,240,176,80,48,201,208,224,208,192,208,162,56,184,138,208,144,112,48,201,208,224,208,192,208,76,234,186,142,160,162,169,24,36,154,240,16,176,80,201,208,224,208,192,208,160,169,56,184,162,186,240,48,144,112,224,208,201,208,192,208,76,174,154,96,32,169,133,186,142,234,162,154,169,72,169,72,186,224,208,104,201,208,104,201,208,186,224,208,173,201,208,173,201,208,76,234,162,154,32,186,224,208,104,104,186,224,208,169,32,104,201,208,104,201,208,76,234,169,72,169,72,96,162,160,24,36,169,32,96,240,16,176,80,201,208,192,208,224,208,56,184,169,32,96,208,48,144,112,76,234,169,72,169,72,169,72,169,160,162,64,48,80,240,144,201,208,192,208,224,208,169,72,169,72,169,72,169,64,16,112,208,144,201,208,192,208,224,208,76,174,154,96,32,162,160,169,133,234,36,56,169,74,144,208,48,80,201,208,184,169,74,176,240,48,112,201,208,76,234,36,56,169,10,144,208,48,80,201,208,184,56,169,10,176,240,16,112,201,208,76,234,36,56,169,106,144,240,16,80,201,208,184,24,169,106,144,240,48,112,201,208,76,234,36,56,169,42,144,240,48,80,201,208,184,24,169,42,176,240,16,112,201,208,76,96,32,165,141,169,133,169,133,169,133,169,133,169,133,133,169,133,169,133,169,141,169,141,169,141,169,141,162,161,201,208,232,232,161,201,208,232,161,201,208,162,161,201,208,162,161,201,240,169,162,129,232,232,169,129,232,169,129,162,169,129,173,201,208,173,201,208,173,201,208,173,201,240,173,133,169,141,169,141,162,160,32,24,169,133,36,169,96,1,32,176,16,201,208,80,96,200,32,56,184,169,96,1,32,208,112,144,48,96,200,32,24,36,169,96,33,32,208,80,176,48,96,200,169,141,32,56,184,169,96,33,32,144,16,201,208,112,96,200,32,24,36,169,96,65,32,176,16,201,208,80,96,200,169,141,32,56,184,169,96,65,32,208,112,144,48,96,200,169,141,32,24,36,169,96,97,32,48,176,201,208,112,96,200,32,56,36,169,96,97,32,48,176,201,208,112,96,200,169,141,32,56,184,169,96,97,32,16,176,201,208,80,96,200,169,141,32,24,36,169,96,97,32,16,176,201,208,112,96,200,32,56,184,169,96,97,32,208,48,112,144,96,200,169,141,32,36,169,96,193,32,48,144,208,80,96,200,72,169,141,104,32,184,96,193,32,240,48,144,112,96,200,72,169,141,104,193,32,240,16,16,96,200,72,169,141,104,32,169,96,193,32,240,16,144,96,200,72,169,141,104,193,32,208,48,144,96,200,72,169,141,104,193,32,176,240,16,96,200,72,169,141,104,193,32,144,240,48,96,200,169,141,32,36,169,56,96,225,32,48,144,208,112,201,208,96,200,169,141,32,184,56,169,96,225,32,240,48,144,112,201,208,96,200,169,141,32,169,56,36,96,225,32,176,240,16,112,201,208,96,200,169,141,32,24,169,96,225,32,144,201,208,96,200,169,141,32,56,169,96,225,32,80,144,201,208,96,96,32,169,133,169,133,36,160,162,169,165,240,48,201,208,192,208,224,80,240,169,36,133,240,16,80,165,201,240,169,133,36,169,162,160,164,240,48,192,208,201,208,224,80,240,160,36,132,240,16,80,164,192,240,36,169,133,160,169,162,166,240,48,224,208,192,208,201,80,240,162,36,134,240,16,80,166,224,240,169,133,162,160,169,36,16,80,208,201,208,224,208,192,240,169,133,169,36,48,112,240,201,240,160,169,133,32,24,169,133,36,169,96,5,32,176,16,201,208,80,96,200,169,133,32,56,184,169,96,5,32,208,112,144,48,96,200,169,133,32,24,36,169,96,37,32,208,80,176,48,96,200,169,133,32,56,184,169,96,37,32,144,16,201,208,112,96,200,169,133,32,24,36,169,96,69,32,176,16,201,208,80,96,200,169,133,32,56,184,169,96,69,32,208,112,144,48,96,200,169,133,32,24,36,169,96,101,32,48,176,201,208,112,96,200,32,56,36,169,96,101,32,48,176,201,208,112,96,200,169,133,32,56,184,169,96,101,32,16,176,201,208,80,96,200,169,133,32,24,36,169,96,101,32,16,176,201,208,112,96,200,32,56,184,169,96,101,32,208,48,112,144,96,200,169,133,32,36,169,96,197,32,48,144,208,80,96,200,72,169,133,104,32,184,96,197,32,240,48,144,112,96,200,72,169,133,104,197,32,240,16,16,96,200,72,169,133,104,32,169,96,197,32,240,16,144,96,200,72,169,133,104,197,32,208,48,144,96,200,72,169,133,104,197,32,176,240,16,96,200,72,169,133,104,197,32,144,240,48,96,200,169,133,32,36,169,56,96,229,32,48,144,208,112,201,208,96,200,169,133,32,184,56,169,96,229,32,240,48,144,112,201,208,96,200,169,133,32,169,56,36,96,229,32,176,240,16,112,201,208,96,200,169,133,32,24,169,96,229,32,144,201,208,96,200,169,133,32,56,169,96,229,32,80,144,201,208,96,200,169,133,32,36,169,96,170,228,32,48,144,208,80,96,200,169,133,32,184,96,228,32,240,48,144,112,96,200,169,133,228,32,240,16,16,96,200,169,133,32,169,96,170,228,32,240,16,144,96,200,169,133,228,32,208,48,144,96,200,169,133,228,32,176,240,16,96,200,169,133,228,32,144,240,48,96,200,152,170,169,133,32,36,160,96,196,32,48,144,208,80,96,232,169,133,32,184,96,196,32,240,48,144,112,96,232,169,133,196,32,240,16,16,96,232,169,133,32,160,96,196,32,240,16,144,96,232,169,133,196,32,208,48,144,96,232,169,133,196,32,176,240,16,96,232,169,133,196,32,144,240,48,96,232,138,168,32,162,169,133,234,36,56,169,96,133,70,165,32,144,208,48,80,201,208,184,169,96,200,133,70,165,32,176,240,48,112,201,208,96,200,32,36,56,169,96,133,6,165,32,144,208,48,80,201,208,184,169,56,96,200,133,6,165,32,176,240,16,112,201,208,96,200,32,36,56,169,96,133,102,165,32,144,240,16,80,201,208,184,24,169,96,200,133,102,165,32,144,240,48,112,201,208,96,200,32,36,56,169,96,133,38,165,32,144,240,48,80,201,208,184,24,169,96,200,133,38,165,32,176,240,16,112,201,208,96,169,133,133,36,56,230,208,48,80,144,165,201,240,169,133,184,24,230,240,16,112,176,165,201,240,169,133,36,56,198,240,16,80,144,165,201,240,169,133,184,24,198,240,48,112,176,165,201,240,169,133,198,240,96,32,169,141,169,133,36,160,162,169,173,240,48,201,208,192,208,224,80,240,169,36,141,240,16,80,173,201,240,169,141,36,169,162,160,172,240,48,192,208,201,208,224,80,240,160,36,140,240,16,80,172,192,240,36,169,141,160,169,162,174,240,48,224,208,192,208,201,80,240,162,36,142,240,16,80,174,224,240,169,141,162,160,169,44,16,80,208,201,208,224,208,192,240,169,141,169,44,48,112,240,201,240,160,169,141,32,24,169,133,36,169,96,13,32,176,16,201,208,80,96,200,169,141,32,56,184,169,96,13,32,208,112,144,48,96,200,169,141,32,24,36,169,96,45,32,208,80,176,48,96,200,169,141,32,56,184,169,96,45,32,144,16,201,208,112,96,200,169,141,32,24,36,169,96,77,32,176,16,201,208,80,96,200,169,141,32,56,184,169,96,77,32,208,112,144,48,96,200,169,141,32,24,36,169,96,109,32,48,176,201,208,112,96,200,32,56,36,169,96,109,32,48,176,201,208,112,96,200,169,141,32,56,184,169,96,109,32,16,176,201,208,80,96,200,169,141,32,24,36,169,96,109,32,16,176,201,208,112,96,200,32,56,184,169,96,109,32,208,48,112,144,96,200,169,141,32,36,169,96,205,32,48,144,208,80,96,200,72,169,141,104,32,184,96,205,32,240,48,144,112,96,200,72,169,141,104,205,32,240,16,16,96,200,72,169,141,104,32,169,96,205,32,240,16,144,96,200,72,169,141,104,205,32,208,48,144,96,200,72,169,141,104,205,32,176,240,16,96,200,72,169,141,104,205,32,144,240,48,96,200,169,141,32,36,169,56,96,237,32,48,144,208,112,201,208,96,200,169,141,32,184,56,169,96,237,32,240,48,144,112,201,208,96,200,169,141,32,169,56,36,96,237,32,176,240,16,112,201,208,96,200,169,141,32,24,169,96,237,32,144,201,208,96,200,169,141,32,56,169,96,237,32,80,144,201,208,96,200,169,141,32,36,169,96,170,236,32,48,144,208,80,96,200,169,141,32,184,96,236,32,240,48,144,112,96,200,169,141,236,32,240,16,16,96,200,169,141,32,169,96,170,236,32,240,16,144,96,200,169,141,236,32,208,48,144,96,200,169,141,236,32,176,240,16,96,200,169,141,236,32,144,240,48,96,200,152,170,169,141,32,36,160,96,204,32,48,144,208,80,96,232,169,141,32,184,96,204,32,240,48,144,112,96,232,169,141,204,32,240,16,16,96,232,169,141,32,160,96,204,32,240,16,144,96,232,169,141,204,32,208,48,144,96,232,169,141,204,32,176,240,16,96,232,169,141,204,32,144,240,48,96,232,138,168,32,162,169,133,234,36,56,169,96,141,78,173,32,144,208,48,80,201,208,184,169,96,200,141,78,173,32,176,240,48,112,201,208,96,200,32,36,56,169,96,141,14,173,32,144,208,48,80,201,208,184,169,56,96,200,141,14,173,32,176,240,16,112,201,208,96,200,32,36,56,169,96,141,110,173,32,144,240,16,80,201,208,184,24,169,96,200,141,110,173,32,144,240,48,112,201,208,96,200,32,36,56,169,96,141,46,173,32,144,240,48,80,201,208,184,24,169,96,200,141,46,173,32,176,240,16,112,201,208,96,169,141,133,36,56,238,208,48,80,144,173,201,240,169,141,184,24,238,240,16,112,176,173,201,240,169,141,36,56,206,240,16,80,144,173,201,240,169,141,184,24,206,240,48,112,176,173,201,240,169,141,206,240,96,32,169,133,169,141,169,141,169,133,162,169,133,169,133,160,56,169,184,177,240,144,112,201,208,224,240,169,133,133,36,160,177,201,208,176,165,72,169,133,169,133,160,177,201,240,104,133,162,169,133,169,133,160,24,169,133,36,169,141,169,17,176,16,201,208,112,232,56,184,169,17,240,112,144,48,232,24,36,169,49,208,80,176,16,232,56,184,169,141,169,49,144,16,201,208,80,232,24,36,169,141,169,81,176,16,201,208,112,232,56,184,169,141,81,208,112,144,16,232,24,36,169,141,169,113,48,176,201,208,80,232,56,36,169,113,48,176,201,208,80,232,56,184,169,141,113,16,176,201,208,112,232,24,36,169,141,169,113,16,176,201,208,80,232,56,184,169,141,169,113,208,48,112,176,232,36,169,141,209,48,144,208,112,232,184,206,209,240,48,144,80,232,238,238,209,240,48,232,169,141,169,209,240,16,176,232,160,140,160,209,208,48,176,232,238,209,176,240,48,232,206,206,209,144,240,16,96,165,133,169,133,32,169,133,169,133,160,162,36,169,141,56,241,48,144,208,112,201,240,232,184,56,169,206,241,240,48,144,112,201,240,232,169,56,36,238,238,241,176,240,16,112,201,240,232,24,169,141,169,241,144,201,240,232,56,169,141,169,241,80,144,201,240,232,169,169,145,173,201,240,232,169,141,169,141,108,169,141,169,141,169,141,169,141,169,141,169,141,169,141,169,141,169,141,32,108,169,96,201,240,96,32,169,141,169,133,169,141,162,160,56,169,184,185,240,144,112,201,208,224,240,169,133,36,160,185,201,208,176,169,133,160,185,201,240,162,24,169,133,36,169,141,169,160,25,176,16,201,208,112,232,56,184,169,25,240,112,144,48,232,24,36,169,57,208,80,176,16,232,56,184,169,141,169,57,144,16,201,208,80,232,24,36,169,141,169,89,176,16,201,208,112,232,56,184,169,141,89,208,112,144,16,232,24,36,169,141,169,121,48,176,201,208,80,232,56,36,169,121,48,176,201,208,80,232,56,184,169,141,121,16,176,201,208,112,232,24,36,169,141,169,121,16,176,201,208,80,232,56,184,169,141,169,121,208,48,112,176,232,36,169,141,217,48,144,208,112,232,184,206,217,240,48,144,80,232,238,238,217,240,48,232,169,141,169,217,240,16,176,232,160,140,160,217,208,48,176,232,238,217,176,240,48,232,206,206,217,144,240,16,232,36,169,141,56,249,48,144,208,112,201,240,232,184,56,169,206,249,240,48,144,112,201,240,232,169,56,36,238,238,249,176,240,16,112,201,240,232,24,169,141,169,249,144,201,240,232,56,169,141,169,249,80,144,201,240,232,169,169,153,173,201,240,96,32,169,133,169,133,169,133,162,169,36,56,160,180,16,240,80,144,201,208,224,208,192,240,162,169,184,24,160,180,16,240,112,176,192,208,201,208,224,240,36,56,160,162,148,165,144,201,208,80,24,184,160,162,148,165,176,201,208,80,160,169,162,133,32,24,169,133,36,169,96,21,32,176,16,201,208,80,96,200,169,133,32,56,184,169,96,21,32,208,112,144,48,96,200,169,133,32,24,36,169,96,53,32,208,80,176,48,96,200,169,133,32,56,184,169,96,53,32,144,16,201,208,112,96,200,169,133,32,24,36,169,96,85,32,176,16,201,208,80,96,200,169,133,32,56,184,169,96,85,32,208,112,144,48,96,200,169,133,32,24,36,169,96,117,32,48,176,201,208,112,96,200,32,56,36,169,96,117,32,48,176,201,208,112,96,200,169,133,32,56,184,169,96,117,32,16,176,201,208,80,96,200,169,133,32,24,36,169,96,117,32,16,176,201,208,112,96,200,32,56,184,169,96,117,32,208,48,112,144,96,200,169,133,32,36,169,96,213,32,48,144,208,80,96,200,72,169,133,104,32,184,96,213,32,240,48,144,112,96,200,72,169,133,104,213,32,240,16,16,96,200,72,169,133,104,32,169,96,213,32,240,16,144,96,200,72,169,133,104,213,32,208,48,144,96,200,72,169,133,104,213,32,176,240,16,96,200,72,169,133,104,213,32,144,240,48,96,200,169,133,32,36,169,56,96,245,32,48,144,208,112,201,208,96,200,169,133,32,184,56,169,96,245,32,240,48,144,112,201,208,96,200,169,133,32,169,56,36,96,245,32,176,240,16,112,201,208,96,200,169,133,32,24,169,96,245,32,144,201,208,96,200,169,133,32,56,169,96,245,32,80,144,201,208,96,169,133,169,133,162,160,36,56,169,181,16,240,80,144,192,208,224,208,201,240,162,160,184,24,169,181,16,240,112,176,201,208,192,208,224,240,36,56,169,162,149,165,144,201,208,80,24,184,169,162,149,165,176,201,208,80,160,162,32,162,169,133,234,36,56,169,96,149,86,181,32,144,208,48,80,201,208,184,169,96,200,149,86,181,32,176,240,48,112,201,208,96,200,32,36,56,169,96,149,22,181,32,144,208,48,80,201,208,184,169,56,96,200,149,22,181,32,176,240,16,112,201,208,96,200,32,36,56,169,96,149,118,181,32,144,240,16,80,201,208,184,24,169,96,200,149,118,181,32,144,240,48,112,201,208,96,200,32,36,56,169,96,149,54,181,32,144,240,48,80,201,208,184,24,169,96,200,149,54,181,32,176,240,16,112,201,208,96,169,149,133,36,56,246,208,48,80,144,181,201,240,169,149,184,24,246,240,16,112,176,181,201,240,169,149,36,56,214,240,16,80,144,181,201,240,169,149,184,24,214,240,48,112,176,181,201,240,169,149,214,240,169,133,169,160,162,56,36,182,144,80,48,240,224,208,192,208,201,240,169,133,169,160,162,24,184,182,176,112,16,240,224,208,192,208,201,240,169,133,169,160,162,24,184,150,176,112,48,240,224,208,192,208,201,208,165,201,240,169,133,169,160,36,162,56,150,144,80,48,208,224,208,192,208,201,208,165,240,96,32,169,133,169,141,169,141,162,169,36,56,160,188,16,240,80,144,201,208,224,208,192,240,162,169,184,24,160,188,16,240,112,176,192,208,201,208,224,240,160,169,162,141,32,24,169,133,36,169,96,29,32,176,16,201,208,80,96,200,169,141,32,56,184,169,96,29,32,208,112,144,48,96,200,169,141,32,24,36,169,96,61,32,208,80,176,48,96,200,169,141,32,56,184,169,96,61,32,144,16,201,208,112,96,200,169,141,32,24,36,169,96,93,32,176,16,201,208,80,96,200,169,141,32,56,184,169,96,93,32,208,112,144,48,96,200,169,141,32,24,36,169,96,125,32,48,176,201,208,112,96,200,32,56,36,169,96,125,32,48,176,201,208,112,96,200,169,141,32,56,184,169,96,125,32,16,176,201,208,80,96,200,169,141,32,24,36,169,96,125,32,16,176,201,208,112,96,200,32,56,184,169,96,125,32,208,48,112,144,96,200,169,141,32,36,169,96,221,32,48,144,208,80,96,200,72,169,141,104,32,184,96,221,32,240,48,144,112,96,200,72,169,141,104,221,32,240,16,16,96,200,72,169,141,104,32,169,96,221,32,240,16,144,96,200,72,169,141,104,221,32,208,48,144,96,200,72,169,141,104,221,32,176,240,16,96,200,72,169,141,104,221,32,144,240,48,96,200,169,141,32,36,169,56,96,253,32,48,144,208,112,201,208,96,200,169,141,32,184,56,169,96,253,32,240,48,144,112,201,208,96,200,169,141,32,169,56,36,96,253,32,176,240,16,112,201,208,96,200,169,141,32,24,169,96,253,32,144,201,208,96,200,169,141,32,56,169,96,253,32,80,144,201,208,96,169,141,169,141,162,160,36,56,169,189,16,240,80,144,192,208,224,208,201,240,162,160,184,24,169,189,16,240,112,176,201,208,192,208,224,240,36,56,169,162,157,173,144,201,208,80,24,184,169,162,157,173,176,201,208,80,160,162,32,162,169,133,234,36,56,169,96,157,94,189,32,144,208,48,80,201,208,184,169,96,200,157,94,189,32,176,240,48,112,201,208,96,200,32,36,56,169,96,157,30,189,32,144,208,48,80,201,208,184,169,56,96,200,157,30,189,32,176,240,16,112,201,208,96,200,32,36,56,169,96,157,126,189,32,144,240,16,80,201,208,184,24,169,96,200,157,126,189,32,144,240,48,112,201,208,96,200,32,36,56,169,96,157,62,189,32,144,240,48,80,201,208,184,24,169,96,200,157,62,189,32,176,240,16,112,201,208,96,169,157,133,36,56,254,208,48,80,144,189,201,240,169,157,184,24,254,240,16,112,176,189,201,240,169,157,36,56,222,240,16,80,144,189,201,240,169,157,184,24,222,240,48,112,176,189,201,240,169,157,222,240,169,141,169,160,162,56,36,190,144,80,48,240,224,208,192,208,201,240,169,141,169,160,162,24,184,190,176,112,16,240,224,208,192,208,201,240,96,32,160,169,133,32,169,72,169,208,40,4,68,100,234,234,234,234,8,72,12,234,234,234,234,8,72,20,52,84,116,212,244,234,234,234,234,8,72,26,58,90,122,218,250,128,234,234,234,234,8,72,28,60,92,124,220,252,234,234,234,234,8,72,162,104,201,240,201,240,104,41,201,240,201,240,200,202,208,104,201,240,201,240,104,41,201,240,201,240,200,202,208,104,201,240,201,240,104,41,201,240,201,240,200,202,208,104,201,240,201,240,104,41,201,240,201,240,200,202,208,104,201,240,201,240,104,41,201,240,201,240,200,202,208,96,32,169,72,169,40,4,68,100,234,234,234,234,8,72,12,234,234,234,234,8,72,20,52,84,116,212,244,234,234,234,234,8,72,26,58,90,122,218,250,128,234,234,234,234,8,72,28,60,92,124,220,252,234,234,234,234,8,72,162,104,201,240,104,41,201,240,200,202,208,104,201,240,104,41,201,240,200,202,208,104,201,240,104,41,201,240,200,202,208,104,201,240,104,41,201,240,200,202,208,104,201,240,104,41,201,240,200,202,208,96,96,32,169,141,169,141,169,133,169,133,169,133,169,133,162,160,169,133,36,56,169,163,234,234,234,234,240,48,80,144,201,208,224,208,192,240,162,160,184,24,169,163,234,234,234,234,240,16,112,176,201,208,224,208,192,240,169,133,169,133,160,36,56,169,167,234,234,234,234,240,16,80,144,201,208,224,208,192,240,160,184,24,169,167,234,234,234,234,240,48,112,176,201,208,224,208,192,240,169,141,169,141,160,36,56,169,175,234,234,234,234,240,16,80,144,201,208,224,208,192,240,160,184,24,169,175,234,234,234,234,240,48,112,176,201,208,224,208,192,240,169,133,169,133,169,133,169,133,169,141,169,141,162,160,36,56,169,179,234,234,234,234,240,48,80,144,201,208,224,208,192,240,162,160,184,24,169,179,234,234,234,234,240,16,112,176,201,208,224,208,192,240,169,133,169,133,160,36,56,169,183,234,234,234,234,240,16,80,144,201,208,224,208,192,240,160,184,24,169,183,234,234,234,234,240,48,112,176,201,208,224,208,192,240,169,141,169,141,160,36,56,169,191,234,234,234,234,240,16,80,144,201,208,224,208,192,240,160,184,24,169,191,234,234,234,234,240,48,112,176,201,208,224,208,192,240,96,32,169,133,169,141,169,133,169,133,160,162,169,36,24,131,234,234,234,234,208,176,80,16,201,208,192,208,224,208,173,201,240,160,162,169,56,184,131,234,234,234,234,240,144,112,48,201,208,192,208,224,208,173,201,240,169,133,160,162,169,36,24,135,234,234,234,234,240,176,80,16,201,208,192,208,224,208,165,201,240,169,133,160,162,169,56,184,135,234,234,234,234,240,144,112,48,201,208,192,208,224,208,165,201,240,169,141,160,162,169,36,24,143,234,234,234,234,240,176,80,16,201,208,192,208,224,208,173,201,240,169,141,160,162,169,56,184,143,234,234,234,234,240,144,112,16,201,208,192,208,224,208,173,201,240,169,133,160,162,169,36,24,151,234,234,234,234,240,176,80,16,201,208,192,208,224,208,165,201,240,169,133,160,162,169,56,184,151,234,234,234,234,240,144,112,48,201,208,192,208,224,208,165,201,240,96,32,160,32,36,169,56,96,235,234,234,234,234,32,48,144,208,112,201,208,96,200,32,184,56,169,96,235,234,234,234,234,32,240,48,144,112,201,208,96,200,32,169,56,36,96,235,234,234,234,234,32,176,240,16,112,201,208,96,200,32,24,169,96,235,234,234,234,234,32,144,201,208,96,200,32,56,169,96,235,234,234,234,234,32,80,144,201,208,96,96,32,169,133,160,162,169,133,169,133,169,141,32,36,24,169,96,195,234,234,234,234,32,80,176,48,201,208,96,173,201,240,200,169,141,32,184,56,169,96,195,234,234,234,234,32,112,208,48,144,201,208,96,173,201,240,200,169,141,32,36,169,96,195,234,234,234,234,32,80,240,16,144,201,240,96,173,201,240,200,169,133,32,36,24,169,96,199,234,234,234,234,32,80,176,48,201,208,96,165,201,240,200,169,133,32,184,56,169,96,199,234,234,234,234,32,112,208,48,144,201,208,96,165,201,240,200,169,133,32,36,169,96,199,234,234,234,234,32,80,240,16,144,201,240,96,165,201,240,200,169,141,32,36,24,169,96,207,234,234,234,234,32,80,176,48,201,208,96,173,201,240,200,169,141,32,184,56,169,96,207,234,234,234,234,32,112,208,48,144,201,208,96,173,201,240,200,169,141,32,36,169,96,207,234,234,234,234,32,80,240,16,144,201,240,96,173,201,240,169,141,169,133,169,133,160,32,36,24,169,96,211,234,234,8,72,160,104,40,32,80,176,48,201,208,96,173,201,240,160,169,141,32,184,56,169,96,211,234,234,8,72,160,104,40,32,112,208,48,144,201,208,96,173,201,240,160,169,141,32,36,169,96,211,234,234,8,72,160,104,40,32,80,240,16,144,201,240,96,173,201,240,160,162,169,133,32,36,24,169,96,215,234,234,234,234,32,80,176,48,201,208,96,165,201,240,200,169,133,32,184,56,169,96,215,234,234,234,234,32,112,208,48,144,201,208,96,165,201,240,200,169,133,32,36,169,96,215,234,234,234,234,32,80,240,16,144,201,240,96,165,201,240,169,141,160,32,36,24,169,96,219,234,234,8,72,160,104,40,32,80,176,48,201,208,96,173,201,240,160,169,141,32,184,56,169,96,219,234,234,8,72,160,104,40,32,112,208,48,144,201,208,96,173,201,240,160,169,141,32,36,169,96,219,234,234,8,72,160,104,40,32,80,240,16,144,201,240,96,173,201,240,160,162,169,141,32,36,24,169,96,223,234,234,234,234,32,80,176,48,201,208,96,173,201,240,200,169,141,32,184,56,169,96,223,234,234,234,234,32,112,208,48,144,201,208,96,173,201,240,200,169,141,32,36,169,96,223,234,234,234,234,32,80,240,16,144,201,240,96,173,201,240,96,32,169,133,160,162,169,133,169,133,169,141,32,36,24,169,96,227,234,234,234,234,32,112,176,48,201,208,96,173,201,240,200,169,141,32,184,56,169,96,227,234,234,234,234,32,112,240,16,144,201,208,96,173,201,240,200,169,141,32,36,56,169,96,227,234,234,234,234,32,112,240,16,144,201,240,96,173,201,240,200,169,133,32,36,24,169,96,231,234,234,234,234,32,112,176,48,201,208,96,165,201,240,200,169,133,32,184,56,169,96,231,234,234,234,234,32,112,240,16,144,201,208,96,165,201,240,200,169,133,32,36,56,169,96,231,234,234,234,234,32,112,240,16,144,201,240,96,165,201,240,200,169,141,32,36,24,169,96,239,234,234,234,234,32,112,176,48,201,208,96,173,201,240,200,169,141,32,184,56,169,96,239,234,234,234,234,32,112,240,16,144,201,208,96,173,201,240,200,169,141,32,36,56,169,96,239,234,234,234,234,32,112,240,16,144,201,240,96,173,201,240,169,141,169,133,169,133,160,32,36,24,169,96,243,234,234,8,72,160,104,40,32,112,176,48,201,208,96,173,201,240,160,169,141,32,184,56,169,96,243,234,234,8,72,160,104,40,32,112,240,16,144,201,208,96,173,201,240,160,169,141,32,36,56,169,96,243,234,234,8,72,160,104,40,32,112,240,16,144,201,240,96,173,201,240,160,162,169,133,32,36,24,169,96,247,234,234,234,234,32,112,176,48,201,208,96,165,201,240,200,169,133,32,184,56,169,96,247,234,234,234,234,32,112,240,16,144,201,208,96,165,201,240,200,169,133,32,36,56,169,96,247,234,234,234,234,32,112,240,16,144,201,240,96,165,201,240,169,141,160,32,36,24,169,96,251,234,234,8,72,160,104,40,32,112,176,48,201,208,96,173,201,240,160,169,141,32,184,56,169,96,251,234,234,8,72,160,104,40,32,112,240,16,144,201,208,96,173,201,240,160,169,141,32,36,56,169,96,251,234,234,8,72,160,104,40,32,112,240,16,144,201,240,96,173,201,240,160,162,169,141,32,36,24,169,96,255,234,234,234,234,32,112,176,48,201,208,96,173,201,240,200,169,141,32,184,56,169,96,255,234,234,234,234,32,112,240,16,144,201,208,96,173,201,240,200,169,141,32,36,56,169,96,255,234,234,234,234,32,112,240,16,144,201,240,96,173,201,240,96,32,169,133,160,162,169,133,169,133,169,141,32,36,24,169,96,3,234,234,234,234,32,80,144,16,201,208,96,173,201,240,200,169,141,32,184,24,169,96,3,234,234,234,234,32,112,240,16,176,201,208,96,173,201,240,200,169,141,32,36,56,169,96,3,234,234,234,234,32,80,240,48,176,201,208,96,173,201,240,200,169,133,32,36,24,169,96,7,234,234,234,234,32,80,144,16,201,208,96,165,201,240,200,169,133,32,184,24,169,96,7,234,234,234,234,32,112,240,16,176,201,208,96,165,201,240,200,169,133,32,36,56,169,96,7,234,234,234,234,32,80,240,48,176,201,208,96,165,201,240,200,169,141,32,36,24,169,96,15,234,234,234,234,32,80,144,16,201,208,96,173,201,240,200,169,141,32,184,24,169,96,15,234,234,234,234,32,112,240,16,176,201,208,96,173,201,240,200,169,141,32,36,56,169,96,15,234,234,234,234,32,80,240,48,176,201,208,96,173,201,240,169,141,169,133,169,133,160,32,36,24,169,96,19,234,234,8,72,160,104,40,32,80,144,16,201,208,96,173,201,240,160,169,141,32,184,24,169,96,19,234,234,8,72,160,104,40,32,112,240,16,176,201,208,96,173,201,240,160,169,141,32,36,56,169,96,19,234,234,8,72,160,104,40,32,80,240,48,176,201,208,96,173,201,240,160,162,169,133,32,36,24,169,96,23,234,234,234,234,32,80,144,16,201,208,96,165,201,240,200,169,133,32,184,24,169,96,23,234,234,234,234,32,112,240,16,176,201,208,96,165,201,240,200,169,133,32,36,56,169,96,23,234,234,234,234,32,80,240,48,176,201,208,96,165,201,240,169,141,160,32,36,24,169,96,27,234,234,8,72,160,104,40,32,80,144,16,201,208,96,173,201,240,160,169,141,32,184,24,169,96,27,234,234,8,72,160,104,40,32,112,240,16,176,201,208,96,173,201,240,160,169,141,32,36,56,169,96,27,234,234,8,72,160,104,40,32,80,240,48,176,201,208,96,173,201,240,160,162,169,141,32,36,24,169,96,31,234,234,234,234,32,80,144,16,201,208,96,173,201,240,200,169,141,32,184,24,169,96,31,234,234,234,234,32,112,240,16,176,201,208,96,173,201,240,200,169,141,32,36,56,169,96,31,234,234,234,234,32,80,240,48,176,201,208,96,173,201,240,96,32,169,133,160,162,169,133,169,133,169,141,32,36,24,169,96,35,234,234,234,234,32,80,144,48,201,208,96,173,201,240,200,169,141,32,184,24,169,96,35,234,234,234,234,32,112,240,48,176,201,240,96,173,201,240,200,169,141,32,36,56,169,96,35,234,234,234,234,32,80,240,48,176,201,208,96,173,201,240,200,169,133,32,36,24,169,96,39,234,234,234,234,32,80,144,48,201,208,96,165,201,240,200,169,133,32,184,24,169,96,39,234,234,234,234,32,112,240,48,176,201,240,96,165,201,240,200,169,133,32,36,56,169,96,39,234,234,234,234,32,80,240,48,176,201,208,96,165,201,240,200,169,141,32,36,24,169,96,47,234,234,234,234,32,80,144,48,201,208,96,173,201,240,200,169,141,32,184,24,169,96,47,234,234,234,234,32,112,240,48,176,201,240,96,173,201,240,200,169,141,32,36,56,169,96,47,234,234,234,234,32,80,240,48,176,201,208,96,173,201,240,169,141,169,133,169,133,160,32,36,24,169,96,51,234,234,8,72,160,104,40,32,80,144,48,201,208,96,173,201,240,160,169,141,32,184,24,169,96,51,234,234,8,72,160,104,40,32,112,240,48,176,201,240,96,173,201,240,160,169,141,32,36,56,169,96,51,234,234,8,72,160,104,40,32,80,240,48,176,201,208,96,173,201,240,160,162,169,133,32,36,24,169,96,55,234,234,234,234,32,80,144,48,201,208,96,165,201,240,200,169,133,32,184,24,169,96,55,234,234,234,234,32,112,240,48,176,201,240,96,165,201,240,200,169,133,32,36,56,169,96,55,234,234,234,234,32,80,240,48,176,201,208,96,165,201,240,169,141,160,32,36,24,169,96,59,234,234,8,72,160,104,40,32,80,144,48,201,208,96,173,201,240,160,169,141,32,184,24,169,96,59,234,234,8,72,160,104,40,32,112,240,48,176,201,240,96,173,201,240,160,169,141,32,36,56,169,96,59,234,234,8,72,160,104,40,32,80,240,48,176,201,208,96,173,201,240,160,162,169,141,32,36,24,169,96,63,234,234,234,234,32,80,144,48,201,208,96,173,201,240,200,169,141,32,184,24,169,96,63,234,234,234,234,32,112,240,48,176,201,240,96,173,201,240,200,169,141,32,36,56,169,96,63,234,234,234,234,32,80,240,48,176,201,208,96,173,201,240,96,32,169,133,160,162,169,133,169,133,169,141,32,36,24,169,96,67,234,234,234,234,32,80,144,16,201,208,96,173,201,240,200,169,141,32,184,24,169,96,67,234,234,234,234,32,112,240,48,144,201,208,96,173,201,240,200,169,141,32,36,56,169,96,67,234,234,234,234,32,80,240,48,144,201,208,96,173,201,240,200,169,133,32,36,24,169,96,71,234,234,234,234,32,80,144,16,201,208,96,165,201,240,200,169,133,32,184,24,169,96,71,234,234,234,234,32,112,240,48,144,201,208,96,165,201,240,200,169,133,32,36,56,169,96,71,234,234,234,234,32,80,240,48,144,201,208,96,165,201,240,200,169,141,32,36,24,169,96,79,234,234,234,234,32,80,144,16,201,208,96,173,201,240,200,169,141,32,184,24,169,96,79,234,234,234,234,32,112,240,48,144,201,208,96,173,201,240,200,169,141,32,36,56,169,96,79,234,234,234,234,32,80,240,48,144,201,208,96,173,201,240,169,141,169,133,169,133,160,32,36,24,169,96,83,234,234,8,72,160,104,40,32,80,144,16,201,208,96,173,201,240,160,169,141,32,184,24,169,96,83,234,234,8,72,160,104,40,32,112,240,48,144,201,208,96,173,201,240,160,169,141,32,36,56,169,96,83,234,234,8,72,160,104,40,32,80,240,48,144,201,208,96,173,201,240,160,162,169,133,32,36,24,169,96,87,234,234,234,234,32,80,144,16,201,208,96,165,201,240,200,169,133,32,184,24,169,96,87,234,234,234,234,32,112,240,48,144,201,208,96,165,201,240,200,169,133,32,36,56,169,96,87,234,234,234,234,32,80,240,48,144,201,208,96,165,201,240,169,141,160,32,36,24,169,96,91,234,234,8,72,160,104,40,32,80,144,16,201,208,96,173,201,240,160,169,141,32,184,24,169,96,91,234,234,8,72,160,104,40,32,112,240,48,144,201,208,96,173,201,240,160,169,141,32,36,56,169,96,91,234,234,8,72,160,104,40,32,80,240,48,144,201,208,96,173,201,240,160,162,169,141,32,36,24,169,96,95,234,234,234,234,32,80,144,16,201,208,96,173,201,240,200,169,141,32,184,24,169,96,95,234,234,234,234,32,112,240,48,144,201,208,96,173,201,240,200,169,141,32,36,56,169,96,95,234,234,234,234,32,80,240,48,144,201,208,96,173,201,240,96,165,133,169,133,32,169,133,160,162,169,133,169,133,169,141,32,36,24,169,96,99,234,234,234,234,32,112,144,48,201,208,96,173,201,240,200,169,141,32,184,24,169,96,99,234,234,234,234,32,112,48,176,201,208,96,173,201,240,200,169,141,32,36,56,169,96,99,234,234,234,234,32,112,48,144,201,208,96,173,201,240,200,169,133,32,36,24,169,96,103,234,234,234,234,32,112,144,48,201,208,96,165,201,240,200,169,133,32,184,24,169,96,103,234,234,234,234,32,112,48,176,201,208,96,165,201,240,200,169,133,32,36,56,169,96,103,234,234,234,234,32,112,48,144,201,208,96,165,201,240,200,169,141,32,36,24,169,96,111,234,234,234,234,32,112,144,48,201,208,96,173,201,240,200,169,141,32,184,24,169,96,111,234,234,234,234,32,112,48,176,201,208,96,173,201,240,200,169,141,32,36,56,169,96,111,234,234,234,234,32,112,48,144,201,208,96,173,201,240,169,141,169,133,169,133,160,32,36,24,169,96,115,234,234,8,72,160,104,40,32,112,144,48,201,208,96,173,201,240,160,169,141,32,184,24,169,96,115,234,234,8,72,160,104,40,32,112,48,176,201,208,96,173,201,240,160,169,141,32,36,56,169,96,115,234,234,8,72,160,104,40,32,112,48,144,201,208,96,173,201,240,160,162,169,133,32,36,24,169,96,119,234,234,234,234,32,112,144,48,201,208,96,165,201,240,200,169,133,32,184,24,169,96,119,234,234,234,234,32,112,48,176,201,208,96,165,201,240,200,169,133,32,36,56,169,96,119,234,234,234,234,32,112,48,144,201,208,96,165,201,240,169,141,160,32,36,24,169,96,123,234,234,8,72,160,104,40,32,112,144,48,201,208,96,173,201,240,160,169,141,32,184,24,169,96,123,234,234,8,72,160,104,40,32,112,48,176,201,208,96,173,201,240,160,169,141,32,36,56,169,96,123,234,234,8,72,160,104,40,32,112,48,144,201,208,96,173,201,240,160,162,169,141,32,36,24,169,96,127,234,234,234,234,32,112,144,48,201,208,96,173,201,240,200,169,141,32,184,24,169,96,127,234,234,234,234,32,112,48,176,201,208,96,173,201,240,200,169,141,32,36,56,169,96,127,234,234,234,234,32,112,48,144,201,208,96,173,201,240,96,165,5,5,240,32,169,141,169,141,169,141,169,141,169,141,96,96 };
int chonkCount = 0;

int stepCpu(mos6502 *_cpu) {
    //printf("running instruction from 0x%04X\n", _cpu->PC);
    uint8_t opcode = read_mos6502(_cpu, _cpu->PC++);
    printf("%i) \n", chonkCount);
    if (chonker[chonkCount] == opcode){
        printf("EXPECTED: %i, ACTUAL: %i\n", chonker[chonkCount], opcode);
    } else {
        fprintf(stderr, "EXPECTED: %i, ACTUAL: %i\n", chonker[chonkCount], opcode);
    }

    //fprintf(stdout, "RUNNING 0x%04X 0x%02X\n",  _cpu->PC-1, opcode);
    chonkCount++;
    return cpuopmap[opcode](_cpu);

}

void printRegisters(mos6502 *_cpu) {
    fprintf(stdout, "CPU REGISTERS:\n-- A    =0x%02X\n-- X    =0x%02X\n-- Y    =0x%02x\n-- SP   =0x%02X\n-- PC   =0x%04X\n-- FLAGS=0x%02X\n"
            , _cpu->A, _cpu->X, _cpu->Y, _cpu->SP + 0x0100, _cpu->PC, _cpu->flags);
}